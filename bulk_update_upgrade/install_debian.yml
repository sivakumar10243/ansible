---
- name: Bulk unattended install on Debian hosts via AWX
  hosts: all
  become: true
  gather_facts: true

  vars:
    log_file: /var/log/unattended_install.log

  tasks:
    - name: Copy install script to target host
      copy:
        src: files/install_debian.sh
        dest: /tmp/install_debian.sh
        mode: '0755'

    - name: Run installation script and log output
      shell: |
        unset DISPLAY
        chmod +x /tmp/install_debian.sh
        {
          echo "=============================="
          echo "Installation started: $(date)"
          echo "=============================="
          /tmp/install_debian.sh
          echo "Installation completed: $(date)"
        } >> {{ log_file }} 2>&1
